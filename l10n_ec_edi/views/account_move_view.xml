<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

    	<record id="view_move_invoice_customization_form" model="ir.ui.view">
            <field name="name">view.move.invoice.customization.form</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="l10n_latam_invoice_document.view_move_form"/>
            <field name="arch" type="xml">
            	<xpath expr="//h1[hasclass('mt0')]" position="after">
					<field name="show_l10n_ec_authorization" invisible="1"/>
					<field name="edit_l10n_ec_authorization" invisible="1"/>
					<field name="l10n_ec_authorization"
						attrs="{'invisible': [('show_l10n_ec_authorization', '!=', True)],
						        'readonly': [('edit_l10n_ec_authorization', '=', False)]
						       }"
						placeholder="Clave de Acceso o Número de autorización"/>
            	</xpath>
            	<xpath expr="//field[@name='l10n_latam_document_type_id']" position="after">
					<field name="l10n_ec_authorization_type" invisible="1"/>
            		<field name="l10n_ec_printer_id"
						attrs="{'invisible': ['|', '|',  ('country_code', '!=', 'EC'), ('l10n_ec_authorization_type', '!=', 'own'), ('move_type', 'not in', ('out_invoice', 'out_refund', 'in_invoice'))],
						        'required': [('country_code', '=', 'EC'), ('move_type', 'in', ('out_invoice', 'out_refund', 'in_invoice')), ('l10n_ec_authorization_type', '=', 'own')],
						        'readonly': ['|','&amp;',('posted_before', '=', True),('state', '!=', 'draft'),
						                     '&amp;','&amp;',('posted_before', '=', True),('state', '=', 'draft'),('l10n_latam_manual_document_number', '=', False)]
						        }"
						options="{'no_create': True, 'no_open': True}"/>
            	</xpath>
            	<xpath expr="//field[@name='l10n_latam_document_number']" position="after">
					<field name="l10n_ec_payment_method_id"
						attrs="{'invisible': ['|', ('country_code', '!=', 'EC'), ('move_type', 'not in', ('out_invoice','in_invoice'))]}"
						options="{'no_create': True, 'no_open': True}"/>
            	</xpath>
            	<xpath expr="//button[@name='open_reconcile_view']" position="after">
	            	<button name="view_credit_note" type="object" icon="fa-files-o"
						attrs="{'invisible': ['|', '|', ('country_code', '!=', 'EC'),
						('move_type', 'not in', ('out_invoice', 'in_invoice')),
						('refund_count', '=', 0)]}">
						<field name="refund_count" widget="statinfo" string="Refund invoice"/>
					</button>
	            </xpath>
				<xpath expr="//field[@name='to_check']" position="after">
					<field name="l10n_ec_invoice_custom"/>
				</xpath>
				<xpath expr="//page[@id='invoice_tab']" position="after">
					<page id="custom_invoice_tab"
                                  string="Invoice Custom Lines"
                                  attrs="{'invisible': [('l10n_ec_invoice_custom', '=', False)]}">
                                <field name="l10n_ec_custom_line_ids"
                                       widget="section_and_note_one2many"
                                       mode="tree,kanban"
                                       context="{'default_move_type': context.get('default_move_type'), 'journal_id': journal_id, 'default_partner_id': commercial_partner_id, 'default_currency_id': currency_id or company_currency_id}">
                                    <tree editable="bottom" string="Journal Items" default_order="sequence, id">
                                        <control>
                                            <create name="add_line_control" string="Add a line"/>
                                        </control>

                                        <!-- Displayed fields -->
                                        <field name="sequence" widget="handle"/>
                                        <field name="name" widget="section_and_note_text" attrs="{'required': [('parent.move_type', 'not in', ('in_invoice', 'in_refund','in_receipt'))]}"/>
                                        <field name="quantity"/>
                                        <field name="price_unit" string="Price"/>
                                        <field name="tax_ids" widget="many2many_tags"
                                               domain="[('type_tax_use', '=?', parent.invoice_filter_type_domain), ('company_id', '=', parent.company_id)]"
                                               context="{'append_type_to_tax_name': not parent.invoice_filter_type_domain}"
                                               options="{'no_create': True}"
                                               optional="show"/>
                                        <field name="price_subtotal"
                                               string="Subtotal"
                                               groups="account.group_show_line_subtotals_tax_excluded"/>
                                        <field name="price_total"
                                               string="Total"
                                               groups="account.group_show_line_subtotals_tax_included"/>
                                        <!-- Others fields -->
                                        <field name="partner_id" invisible="1"/>
                                        <field name="currency_id" invisible="1"/>
                                    </tree>
                                </field>

                                <!-- Totals (only invoices / receipts) -->
								<group class="oe_subtotal_footer oe_left"
                                    attrs="{'invisible': ['|', ('move_type', 'not in', ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt')),
                                                               ('payment_state' ,'=', 'invoicing_legacy')]}">
                                    <field name="amount_custom_by_group" widget="tax-group-custom-field" nolabel="1" colspan="2" attrs="{'invisible': [('amount_tax', '=', 0)]}"/>
                                </group>
                                <group class="oe_subtotal_footer oe_right"
                                    attrs="{'invisible': ['|', ('move_type', 'not in', ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt')),
                                                               ('payment_state' ,'=', 'invoicing_legacy')]}">
                                    <field name="amount_untaxed" attrs="{'invisible': [('amount_tax', '=', 0)]}"/>
                                    <field name="amount_by_group" widget="tax-group-custom-field" nolabel="1" colspan="2" attrs="{'invisible': [('amount_tax', '=', 0)]}"/>
                                    <field name="amount_total" attrs="{'invisible': [('amount_tax', '!=', 0)]}"/>
                                    <field name="amount_total" class="oe_subtotal_footer_separator" attrs="{'invisible': [('amount_tax', '=', 0)]}"/>
                                </group>
                            </page>
				</xpath>
            	<xpath expr="//page[@name='other_info']" position="after">
	          		<page name="payment_terms" string="Términos de pago" attrs="{'invisible': ['|', ('country_code', '!=', 'EC'), ('move_type', 'not in', ('out_invoice'))]}">
						<group col="4" colspan="4" string="Detalle Forma de Pago SRI">
						<p class="oe_grey" nolabel="1">
							Resolución SRI "NAC-DGERCGC16-00000247", el medio y la forma de pago prevista 
							deben ser registradas en la factura. Esta sección tiene fines "informativos" en 
							documentos impresos y documentos electrónicos. No tienen efecto contable.</p>
							</group>
						<group col="4" colspan="4">
			 				<field name="l10n_ec_invoice_payment_method_ids" force_save="1" readonly="1" nolabel="1">
			                	<tree string="Payment Method">
			                        <field name="payment_method_id"/>
			                        <field name="days_payment_term"/>
			                        <field name="percentage" sum="Total Percentage"/>
			                        <field name="amount" sum="Total amount"/>
			                   	</tree>
			 				</field>
			 			</group>
		 				<group col="4" colspan="4">
							<group col="2" colspan="2">
		                  		<field name="l10n_ec_effective_method"/>
		                  		<field name="l10n_ec_electronic_method"/>
		                  	</group>
		                  	<group col="2" colspan="2">
		                  		<field name="l10n_ec_card_method"/>
		                  		<field name="l10n_ec_other_method"/>
		                  	</group>
						</group>
						<field name="reversal_move_id" attrs="{'invisible': True}"/>
	                </page>
	            </xpath>
	            <xpath expr="//field[@name='l10n_latam_document_type_id']" position="after">
            		<field name="l10n_ec_available_sri_tax_support_ids" invisible="1"/>
					<field name="l10n_ec_sri_tax_support_id"
						attrs="{'invisible': ['|', ('country_code', '!=', 'EC'), ('move_type', 'not in', ('in_invoice', 'in_refund'))], 
								'required': [('country_code', '=', 'EC'), ('move_type', 'in', ('in_invoice', 'in_refund'))]}"
						domain="[('id', 'in', l10n_ec_available_sri_tax_support_ids)]" options="{'no_open': True, 'no_create': True}"/>
            	</xpath>
            </field>
        </record>

    </data>
</odoo>
